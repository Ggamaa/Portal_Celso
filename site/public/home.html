<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="css/styleshomes.css">
</head>

<body>

  <body class="bg-gray-100">

    <div class="flex">
      <!-- Sidebar -->
      <div class="w-64 bg-white h-screen shadow-md">
        <div class="p-4">
          <div class="flex items-center mb-6">
            <span class="ml-2 text-lg font-semibold">Enem Top</span>
          </div>
          <nav>
            <ul>
              <li class="mb-4">
                <a class="flex items-center text-green-500 font-semibold menu-item" href="#">
                  <i class="fas fa-calendar-alt mr-2"></i>
                  Plano de estudos
                </a>
              </li>
              <li class="mb-4">
                <a class="flex items-center text-gray-600 menu-item" href="#">
                  <i class="fas fa-book mr-2"></i>
                  Biblioteca de aulas
                </a>
              </li>
              <li class="mb-4">
                <a class="flex items-center text-gray-600 menu-item" href="#">
                  <i class="fas fa-file-alt mr-2"></i>
                  Simulados semanais
                </a>
              </li>
              <li class="mb-4">
                <a class="flex items-center text-gray-600 menu-item" href="#">
                  <i class="fas fa-pen-alt mr-2"></i>
                  Corretor de redação
                </a>
              </li>
              <li class="mb-4">
                <a class="flex items-center text-gray-600 menu-item" href="#">
                  <i class="fas fa-flask mr-2"></i>
                  Simulados
                </a>
              </li>
              <li class="mb -4">
                <a class="flex items-center text-gray-600 menu-item" href="#">
                  <i class="fas fa-dumbbell mr-2"></i>
                  Exercícios
                </a>
              </li>
              <li class="mb-4">
                <a class="flex items-center text-gray-600 menu-item" href="#">
                  <i class="fas fa-file-alt mr-2"></i>
                  Gabarito Enem
                </a>
              </li>
              <li class="mb-4">
                <a class="flex items-center text-gray-600 menu-item" href="#">
                  <i class="fas fa-graduation-cap mr-2"></i>
                  Simulador Sisu
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>

      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
          <span class="navbar-text">
            <div class="profile-info">
              <img class="profile-pic" id="profilePic" src="<%= profilePic %>" alt="PERFIL" data-bs-toggle="modal"
                data-bs-target="#profileModal" />
            </div>
          </span>
        </div>
      </nav>

      <div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="profileModalLabel">Perfil do Usuário</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="profilePicForm" action="/upload" method="POST" enctype="multipart/form-data">
                <div class="mb-3">
                  <label for="username" class="form-label">Nome de Usuário</label>
                  <input type="text" class="form-control" id="username" value="<%= username %>" readonly>
                </div>
                <div class="mb-3">
                  <label for="email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="email" value="<%= email %>" readonly>
                </div>
                <div class="mb-3">
                  <label for="file-input" class="form-label">Trocar Foto de Perfil</label>
                  <input type="file" id="file-input" name="profilePic" class="form-control-file" accept="image/*"
                    required style="display: none;" onchange="updateProfilePicture(event)">
                  <button type="button" class="btn btn-primary"
                    onclick="document.getElementById('file-input').click();">Selecionar Imagem</button>
                </div>
                <button class="custom-button" type="submit">Enviar</button>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
              <button type="button" class="btn btn-danger" onclick="logout()">Sair</button>
            </div>
          </div>
        </div>
      </div>
      </nav>

      <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="img/artworks-T3wsfRP1KR4XpOXx-e3Kj2w-t1080x1080.jpg " width="150px" height="500px"
              class="d-block w-100" alt="...">
          </div>
          <div class="carousel-item">
            <img src="img/E-um-sinal-de-alerta-para-nos-afirma-Matheusinho-a0126712600202404211853.jpg" width="150px"
              height="500px" class="d-block w-100" alt="...">
          </div>
          <div class="carousel-item">
            <img src="img/images.jpg" width="150px" height="500px" class="d-block w-100" alt="...">
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls"
          data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls"
          data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
        <script>
          // Supondo que você tenha uma maneira de obter as informações do usuário logado
          const username = '<%= username %>'; // Usando EJS ou outra engine de template
          const email = '<%= email %>'; // Substitua pelo valor real
          const userId = '<%= id %>';
      
          document.getElementById('username').textContent = username;
          document.getElementById('email').textContent = email;
      
          function logout() {
        fetch('/api/logout', {
          method: 'POST',
          credentials: 'include' // Incluir cookies se necessário
        })
        .then(response => {
          if (response.ok) {
            // Redirecionar para a página de login ou página inicial após logout
            window.location.href = '/login'; // Altere para a URL correta
          } else {
            // Tratar erro de logout, se necessário
            alert('Erro ao sair. Tente novamente.');
          }
        })
        .catch(error => {
          console.error('Erro:', error);
          alert('Erro ao sair. Tente novamente.');
        });
      }
      
          // Função para carregar a imagem de perfil do servidor
          function loadProfilePicture() {
            fetch(`/api/usuarios/${userId}/imagem-perfil`)
              .then(response => response.blob())
              .then(blob => {
                const reader = new FileReader();
                reader.onload = function (e) {
                  document.getElementById('profile-pic').src = e.target.result;
                };
                reader.readAsDataURL(blob);
              });
          }
      
         
          function updateProfilePicture(event) {
        const file = event.target.files[0];
        if (file) {
          const formData = new FormData();
          formData.append('imagem_perfil', file);
      
          fetch(`/api/usuarios/${userId}/imagem-perfil`, {
            method: 'PUT',
            body: formData
          })
        }
      }
      
      // Adiciona o ouvinte de evento para o input de arquivo
      document.getElementById('file-input').addEventListener('change', updateProfilePicture);
          // Carregar a imagem de perfil quando a página é carregada
          window.onload = function () {
            loadProfilePicture();
          };
      
          // Atualizar a imagem de perfil quando o usuário seleciona uma nova imagem
          document.getElementById('file-input').addEventListener('change', updateProfilePicture);
        </script>
  </body>

</html>